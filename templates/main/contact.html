<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Контакты — monocode</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <style>
            html, body { height: 100%; margin: 0; }
            html { scroll-behavior: smooth; scrollbar-color: #d1d5db #ffffff; scrollbar-width: thin; }
            html::-webkit-scrollbar { width: 8px; height: 8px; }
            html::-webkit-scrollbar-track { background: #ffffff; }
            html::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 8px; }
            body { background: #ffffff; color: #6b7280; font: 14px/1.6 "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; overflow-y: auto; padding-top: 56px;
                cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'><defs><filter id='s' x='-50%' y='-50%' width='200%' height='200%'><feDropShadow dx='0' dy='0' stdDeviation='0.3' flood-color='%239ca3af' flood-opacity='0.35'/></filter></defs><g filter='url(%23s)'><path d='M11 1.8 L20.2 11 L11 20.2 L1.8 11 Z' fill='%23ffffff' fill-opacity='0.7' stroke='%239ca3af' stroke-width='1.1'/><circle cx='11' cy='11' r='1.1' fill='%239ca3af'/></g></svg>") 11 11, auto; }
            a, button { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'><path d='M11 1.8 L20.2 11 L11 20.2 L1.8 11 Z' fill='%23f9fafb' stroke='%23111827' stroke-width='1.5'/><circle cx='11' cy='11' r='1.2' fill='%23111827'/></svg>") 11 11, pointer; }
            header.site { position: fixed; top: 0; left: 0; right: 0; height: 56px; display: flex; align-items: center; z-index: 2; background: rgba(255,255,255,0.72); border-bottom: 1px solid #f3f4f6; backdrop-filter: saturate(160%) blur(6px); transition: background 200ms ease, backdrop-filter 200ms ease, box-shadow 200ms ease; }
            header.site.scrolled { background: rgba(255,255,255,0.9); backdrop-filter: saturate(180%) blur(12px); box-shadow: 0 4px 12px rgba(17,24,39,0.04); }
            header .wrap { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 16px; display: flex; align-items: center; justify-content: space-between; }
            .brand { color: #111827; font-weight: 600; letter-spacing: -0.01em; }
            nav a { color: #6b7280; text-decoration: none; margin-left: 16px; font-size: 13px; }
            nav a:hover { color: #111827; }
            .container { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 16px; }
            .section { padding: 48px 0; }
            .section + .section { border-top: 1px solid #f3f4f6; }
            h1 { margin: 0 0 12px; font-weight: 600; font-size: 40px; line-height: 1.15; color: #111827; letter-spacing: -0.01em; text-align: center; }
            .sub { margin: 0 0 32px; color: #4b5563; text-align: center; }
            .contact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 48px; margin: 32px 0; }
            .contact-info { }
            .contact-form { }
            .contact-item { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; padding: 16px; border: 1px solid #e5e7eb; border-radius: 12px; background: #ffffff; }
            .contact-item i { font-size: 20px; color: #9ca3af; }
            .contact-item-content h3 { margin: 0 0 4px; font-size: 16px; color: #111827; font-weight: 600; }
            .contact-item-content p { margin: 0; color: #6b7280; font-size: 14px; }
            .form-group { margin-bottom: 20px; }
            .form-group label { display: block; margin-bottom: 8px; font-size: 14px; color: #374151; font-weight: 500; }
            .form-group input, .form-group textarea { width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; color: #111827; background: #ffffff; transition: border-color 200ms ease, background-color 200ms ease; }
            .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #111827; }
            .form-group input:disabled, .form-group textarea:disabled { background: #f9fafb; color: #9ca3af; cursor: not-allowed; border-color: #e5e7eb; }
            .form-group textarea { min-height: 120px; resize: vertical; }
            .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border: 1px solid #111827; border-radius: 8px; color: #ffffff; text-decoration: none; background: #111827; font-weight: 500; font-size: 14px; transition: background 200ms ease; cursor: pointer; }
            .btn:hover { background: #374151; }
            .btn:disabled { cursor: not-allowed; opacity: 0.7; }
            .btn i { font-size: 16px; }
            .bx-spin { animation: spin 1s linear infinite; }
            @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
            
            /* Modal styles */
            .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px); }
            .modal.show { display: flex; }
            .modal-content { background: #ffffff; border-radius: 16px; padding: 32px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04); transform: scale(0.9); transition: transform 200ms ease; }
            .modal.show .modal-content { transform: scale(1); }
            .modal-icon { font-size: 48px; margin-bottom: 16px; }
            .modal-icon.success { color: #10b981; }
            .modal-icon.error { color: #ef4444; }
            .modal-title { font-size: 20px; font-weight: 600; color: #111827; margin-bottom: 8px; }
            .modal-message { color: #6b7280; font-size: 14px; line-height: 1.5; margin-bottom: 24px; }
            .modal-btn { background: #111827; color: #ffffff; border: none; border-radius: 8px; padding: 12px 24px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background 200ms ease; }
            .modal-btn:hover { background: #374151; }
            .modal-btn.success { background: #10b981; }
            .modal-btn.success:hover { background: #059669; }
            .modal-btn.error { background: #ef4444; }
            .modal-btn.error:hover { background: #dc2626; }
            
            footer { background: #ffffff; text-align: center; padding: 12px 16px; }
            footer a { color: inherit; text-decoration: none; margin: 0 8px; opacity: 0.85; }
            footer a:hover { opacity: 1; text-decoration: underline; }
            #fx { position:absolute; top:0; left:0; pointer-events:none; z-index:0; }
            @media (max-width: 768px) { 
                .contact-grid { grid-template-columns: 1fr; gap: 32px; }
                h1 { font-size: 32px; }
            }
        </style>
    </head>
    <body>
        <canvas id="fx" width="0" height="0"></canvas>
        <header class="site">
            <div class="wrap">
                <div class="brand" onclick="window.location.href='{% url 'main:home' %}'" style="cursor: pointer;">monocode</div>
                <nav>
                    <a href="{% url 'main:home' %}">Главная</a>
                    <a href="{% url 'main:about' %}">О студии</a>
                    <a href="{% url 'main:contact' %}">Контакты</a>
                    <a href="{% url 'portfolio:portfolio_list' %}">Портфолио</a>
                </nav>
            </div>
        </header>

        <main class="section">
            <div class="container">
                <h1>Контакты</h1>
                <p class="sub">Свяжитесь с нами для обсуждения вашего проекта</p>
                
                <div class="contact-grid">
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class='bx bx-envelope'></i>
                            <div class="contact-item-content">
                                <h3>Email</h3>
                                <p>info@monocode.ru</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class='bx bxl-telegram'></i>
                            <div class="contact-item-content">
                                <h3>Telegram</h3>
                                <p>@monocodeTGBot</p>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div class="contact-form">
                        <form id="contactForm">
                            <div class="form-group">
                                <label for="name">Имя</label>
                                <input type="text" id="name" name="name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" required>
                            </div>

                            <div class="form-group">
                                <label for="telegram">Telegram</label>
                                <input type="text" id="telegram" name="telegram" placeholder="@username">
                            </div>
                            
                            <div class="form-group">
                                <label for="message">Сообщение</label>
                                <textarea id="message" name="message" required></textarea>
                            </div>
                            
                            <button type="submit" class="btn" id="submitBtn">
                                <i class='bx bx-send'></i>
                                <span class="btn-text">Отправить сообщение</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal for notifications -->
        <div id="notificationModal" class="modal">
            <div class="modal-content">
                <div id="modalIcon" class="modal-icon"></div>
                <h3 id="modalTitle" class="modal-title"></h3>
                <p id="modalMessage" class="modal-message"></p>
                <button id="modalBtn" class="modal-btn">Понятно</button>
            </div>
        </div>

        <script>
        (function(){
            const header=document.querySelector('header.site');
            const onScroll=()=>{ if(window.scrollY>8) header.classList.add('scrolled'); else header.classList.remove('scrolled'); };
            onScroll();
            window.addEventListener('scroll', onScroll, {passive:true});

            // click background effect: pixel-aligned grid burst (anchored to page)
            const canvas = document.getElementById('fx');
            const ctx = canvas.getContext('2d');
            const DPR = Math.max(1, Math.floor(window.devicePixelRatio || 1));
            const resize = () => {
                const doc = document.documentElement;
                const w = Math.max(doc.scrollWidth, innerWidth);
                const h = Math.max(doc.scrollHeight, innerHeight);
                canvas.width = Math.floor(w * DPR);
                canvas.height = Math.floor(h * DPR);
                canvas.style.width = w + 'px';
                canvas.style.height = h + 'px';
                ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
            };
            resize();
            window.addEventListener('resize', resize);

            const bursts = [];
            const GRID = 8;
            function snap(v) { return Math.round(v / GRID) * GRID; }
            function addBurst(x, y) {
                const start = performance.now();
                const cells = [];
                const steps = 60 + Math.floor(Math.random() * 40);
                let gx = snap(x), gy = snap(y);
                const dirs = [ [GRID,0], [-GRID,0], [0,GRID], [0,-GRID] ];
                const used = new Set();
                function key(cx, cy) { return cx+','+cy; }
                used.add(key(gx,gy));
                cells.push({ x: gx, y: gy, d: 0 });
                for (let i=0;i<steps;i++) {
                    const [dx,dy] = dirs[(Math.random()*dirs.length)|0];
                    gx += dx; gy += dy;
                    const k = key(gx,gy);
                    if (used.has(k)) continue;
                    used.add(k);
                    cells.push({ x: gx, y: gy, d: i+1 });
                }
                cells.forEach(c => { c.delay = 30 + Math.random()*300 + c.d*6; c.size = 2; c.alpha = 0; });
                bursts.push({ start, cells, duration: 1200 });
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const now = performance.now();
                for (let b = bursts.length - 1; b >= 0; b--) {
                    const burst = bursts[b];
                    const elapsed = now - burst.start;
                    burst.cells.forEach(c => {
                        const t = Math.max(0, Math.min(1, (elapsed - c.delay) / 600));
                        if (t <= 0) return;
                        const ease = t * (2 - t);
                        const sz = 2 + ease * 6;
                        const a = 0.35 * (1 - t);
                        ctx.fillStyle = `rgba(0,0,0,${a})`;
                        const cx = c.x - sz/2, cy = c.y - sz/2;
                        ctx.fillRect(Math.round(cx)+0.5, Math.round(cy)+0.5, Math.round(sz), Math.round(sz));
                    });
                    if (elapsed > burst.duration + 800) bursts.splice(b, 1);
                }
                requestAnimationFrame(draw);
            }
            draw();

            document.addEventListener('click', (e) => {
                const target = e.target;
                if (target.closest('a, button, .btn, .card, .partner, footer')) return;
                const x = window.scrollX + e.clientX;
                const y = window.scrollY + e.clientY;
                addBurst(x, y);
            });

            // Modal functions
            const modal = document.getElementById('notificationModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalTitle = document.getElementById('modalTitle');
            const modalMessage = document.getElementById('modalMessage');
            const modalBtn = document.getElementById('modalBtn');
            
            function showModal(type, title, message) {
                modalIcon.className = `modal-icon ${type}`;
                modalIcon.innerHTML = type === 'success' ? '<i class="bx bx-check-circle"></i>' : '<i class="bx bx-error-circle"></i>';
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalBtn.className = `modal-btn ${type}`;
                modalBtn.textContent = type === 'success' ? 'Отлично!' : 'Понятно';
                modal.classList.add('show');
            }
            
            function hideModal() {
                modal.classList.remove('show');
            }
            
            // Close modal on button click
            modalBtn.addEventListener('click', hideModal);
            
            // Close modal on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal();
                }
            });
            
            // Close modal on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('show')) {
                    hideModal();
                }
            });

            // Form handling
            const form = document.getElementById('contactForm');
            const submitBtn = document.getElementById('submitBtn');
            const btnText = submitBtn.querySelector('.btn-text');
            const btnIcon = submitBtn.querySelector('i');
            
            // Получаем все поля формы
            const formInputs = form.querySelectorAll('input, textarea');
            
            function setFormDisabled(disabled) {
                formInputs.forEach(input => {
                    input.disabled = disabled;
                });
                submitBtn.disabled = disabled;
            }
            
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Получаем данные формы
                const formData = new FormData(form);
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    telegram: formData.get('telegram'),
                    message: formData.get('message')
                };
                
                // Блокируем форму и показываем состояние загрузки
                setFormDisabled(true);
                btnText.textContent = 'Отправка...';
                btnIcon.className = 'bx bx-loader-alt bx-spin';
                
                try {
                    const response = await fetch('{% url "main:send_contact_form" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Успешная отправка
                        btnText.textContent = 'Отправлено!';
                        btnIcon.className = 'bx bx-check';
                        submitBtn.style.background = '#10b981';
                        
                        // Показываем модальное окно успеха
                        showModal('success', 'Сообщение отправлено!', result.message);
                        
                        // Сбрасываем форму
                        form.reset();
                        
                        // Возвращаем форму в исходное состояние через 2 секунды
                        setTimeout(() => {
                            setFormDisabled(false);
                            btnText.textContent = 'Отправить сообщение';
                            btnIcon.className = 'bx bx-send';
                            submitBtn.style.background = '#111827';
                        }, 2000);
                    } else {
                        // Ошибка
                        btnText.textContent = 'Ошибка';
                        btnIcon.className = 'bx bx-error';
                        submitBtn.style.background = '#ef4444';
                        
                        // Показываем модальное окно ошибки
                        showModal('error', 'Ошибка отправки', result.message || 'Произошла ошибка при отправке сообщения');
                        
                        // Возвращаем форму в исходное состояние через 2 секунды
                        setTimeout(() => {
                            setFormDisabled(false);
                            btnText.textContent = 'Отправить сообщение';
                            btnIcon.className = 'bx bx-send';
                            submitBtn.style.background = '#111827';
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Ошибка:', error);
                    btnText.textContent = 'Ошибка';
                    btnIcon.className = 'bx bx-error';
                    submitBtn.style.background = '#ef4444';
                    
                    // Показываем модальное окно ошибки соединения
                    showModal('error', 'Ошибка соединения', 'Произошла ошибка соединения. Проверьте интернет-соединение и попробуйте снова.');
                    
                    // Возвращаем форму в исходное состояние через 2 секунды
                    setTimeout(() => {
                        setFormDisabled(false);
                        btnText.textContent = 'Отправить сообщение';
                        btnIcon.className = 'bx bx-send';
                        submitBtn.style.background = '#111827';
                    }, 2000);
                }
            });
        })();
        </script>

        <footer>
            <a href="{% url 'main:home' %}" rel="noopener">Главная</a>
            <a href="{% url 'main:about' %}" rel="noopener">О студии</a>
            <a href="{% url 'main:contact' %}" rel="noopener">Контакты</a>
            <a href="{% url 'portfolio:portfolio_list' %}" rel="noopener">Портфолио</a>
            </br>
            <p style="margin-top: 7px;">Сделано с <span class="heart" aria-label="с любовью"><i class='bx bxs-heart' style="color:red;"></i></span> студией monocode • © <span id="y"></span></p>
            <script>document.getElementById('y').textContent = new Date().getFullYear();</script>
        </footer>
    </body>
</html>
