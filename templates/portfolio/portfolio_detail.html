{% load portfolio_extras %}
<!doctype html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Корпоративный сайт — Портфолио monocode</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <style>
            html, body { height: 100%; margin: 0; }
            html { scroll-behavior: smooth; scrollbar-color: #d1d5db #ffffff; scrollbar-width: thin; }
            html::-webkit-scrollbar { width: 8px; height: 8px; }
            html::-webkit-scrollbar-track { background: #ffffff; }
            html::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 8px; }
            body { background: #ffffff; color: #6b7280; font: 14px/1.6 "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; overflow-y: auto; padding-top: 56px;
                cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'><defs><filter id='s' x='-50%' y='-50%' width='200%' height='200%'><feDropShadow dx='0' dy='0' stdDeviation='0.3' flood-color='%239ca3af' flood-opacity='0.35'/></filter></defs><g filter='url(%23s)'><path d='M11 1.8 L20.2 11 L11 20.2 L1.8 11 Z' fill='%23ffffff' fill-opacity='0.7' stroke='%239ca3af' stroke-width='1.1'/><circle cx='11' cy='11' r='1.1' fill='%239ca3af'/></g></svg>") 11 11, auto; }
            a, button, .btn { cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'><path d='M11 1.8 L20.2 11 L11 20.2 L1.8 11 Z' fill='%23f9fafb' stroke='%23111827' stroke-width='1.5'/><circle cx='11' cy='11' r='1.2' fill='%23111827'/></svg>") 11 11, pointer; }
            header.site { position: fixed; top: 0; left: 0; right: 0; height: 56px; display: flex; align-items: center; z-index: 2; background: rgba(255,255,255,0.72); border-bottom: 1px solid #f3f4f6; backdrop-filter: saturate(160%) blur(6px); transition: background 200ms ease, backdrop-filter 200ms ease, box-shadow 200ms ease; }
            header.site.scrolled { background: rgba(255,255,255,0.9); backdrop-filter: saturate(180%) blur(12px); box-shadow: 0 4px 12px rgba(17,24,39,0.04); }
            header .wrap { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 16px; display: flex; align-items: center; justify-content: space-between; }
            .brand { color: #111827; font-weight: 600; letter-spacing: -0.01em; }
            nav a { color: #6b7280; text-decoration: none; margin-left: 16px; font-size: 13px; }
            nav a:hover { color: #111827; }
            .container { width: 100%; max-width: 1100px; margin: 0 auto; padding: 0 16px; }
            .section { padding: 48px 0; }
            .section + .section { border-top: 1px solid #f3f4f6; }
            .back-link { display: inline-flex; align-items: center; gap: 8px; color: #6b7280; text-decoration: none; margin-bottom: 24px; font-size: 14px; }
            .back-link:hover { color: #111827; }
            .back-link i { font-size: 16px; }
            h1 { margin: 0 0 12px; font-weight: 600; font-size: 40px; line-height: 1.15; color: #111827; letter-spacing: -0.01em; }
            .project-meta { display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 32px; }
            .meta-item { display: flex; align-items: center; gap: 8px; color: #6b7280; font-size: 14px; }
            .meta-item i { color: #9ca3af; }
            .project-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 32px; }
            .tag { display: inline-block; padding: 6px 12px; border: 1px solid #e5e7eb; border-radius: 999px; font-size: 13px; color: #374151; background: #f9fafb; }
            .project-image { width: 100%; height: 400px; background: #f9fafb; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #9ca3af; font-size: 16px; margin-bottom: 32px; }
            .project-image img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; }
            .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 48px; }
            .main-content h2 { margin: 0 0 16px; font-size: 24px; color: #111827; font-weight: 600; }
            .main-content h3 { margin: 24px 0 12px; font-size: 18px; color: #111827; font-weight: 600; }
            .main-content p { margin: 0 0 16px; line-height: 1.6; }
            .main-content ul { margin: 0 0 16px; padding-left: 20px; }
            .main-content li { margin-bottom: 8px; }
            .sidebar { background: #f9fafb; border-radius: 12px; padding: 24px; height: fit-content; }
            .sidebar h3 { margin: 0 0 16px; font-size: 18px; color: #111827; font-weight: 600; }
            .sidebar-item { margin-bottom: 16px; }
            .sidebar-item:last-child { margin-bottom: 0; }
            .sidebar-label { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
            .sidebar-value { font-size: 14px; color: #111827; font-weight: 500; }
            .project-links { display: flex; gap: 12px; margin-top: 24px; }
            .btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; border: 1px solid #e5e7eb; border-radius: 10px; color: #111827; text-decoration: none; background: #ffffff; font-weight: 500; transition: background 200ms ease; }
            .btn:hover { background: #f9fafb; }
            .btn-primary { background: #111827; color: #ffffff; border-color: #111827; }
            .btn-primary:hover { background: #374151; }
            .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px; margin: 32px 0; }
            .gallery-item { aspect-ratio: 16/10; background: #f9fafb; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #9ca3af; }
            .gallery-item img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; }
            footer { background: #ffffff; text-align: center; padding: 12px 16px; }
            footer a { color: inherit; text-decoration: none; margin: 0 8px; opacity: 0.85; }
            footer a:hover { opacity: 1; text-decoration: underline; }
            #fx { position:absolute; top:0; left:0; pointer-events:none; z-index:0; }
            @media (max-width: 900px) { 
                .content-grid { grid-template-columns: 1fr; gap: 32px; }
                h1 { font-size: 32px; }
                .project-meta { flex-direction: column; gap: 8px; }
            }
        </style>
    </head>
    <body>
        <canvas id="fx" width="0" height="0"></canvas>
        <header class="site">
            <div class="wrap">
                <div class="brand" onclick="window.location.href='{% url 'main:home' %}'" style="cursor: pointer;">monocode</div>
                <nav>
                    <a href="{% url 'main:home' %}">Главная</a>
                    <a href="{% url 'main:about' %}">О студии</a>
                    <a href="{% url 'main:contact' %}">Контакты</a>
                    <a href="{% url 'portfolio:portfolio_list' %}">Портфолио</a>
                </nav>
            </div>
        </header>

        <main class="section">
            <div class="container">
                <a href="{% url 'portfolio:portfolio_list' %}" class="back-link">
                    <i class='bx bx-arrow-back'></i>
                    Назад к портфолио
                </a>

                <h1>{{ project.title }}</h1>
                
                <div class="project-meta">
                    <div class="meta-item">
                        <i class='bx bx-calendar'></i>
                        <span>{{ project.created_at|date:"Y" }}</span>
                    </div>
                    {% if project.duration %}
                    <div class="meta-item">
                        <i class='bx bx-time'></i>
                        <span>{{ project.duration }}</span>
                    </div>
                    {% endif %}
                    {% if project.category %}
                    <div class="meta-item">
                        <i class='bx bx-category'></i>
                        <span>{{ project.category }}</span>
                    </div>
                    {% endif %}
                </div>

                <div class="project-tags">
                    {% for tech in project.technologies|split:"," %}
                        <span class="tag">{{ tech|strip }}</span>
                    {% endfor %}
                </div>

                <div class="project-image">
                    {% if project.cover_image %}
                        <img src="{{ project.cover_image.url }}" alt="{{ project.title }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">
                    {% else %}
                        <i class='bx bx-image' style="font-size: 48px;"></i>
                    {% endif %}
                </div>

                <div class="content-grid">
                    <div class="main-content">
                        <h2>О проекте</h2>
                        {% if project.description %}
                            <p>{{ project.description|linebreaks }}</p>
                        {% else %}
                            <p>Описание проекта отсутствует.</p>
                        {% endif %}

                        {% if project.get_gallery_images %}
                        <h3>Галерея проекта</h3>
                        <div class="gallery">
                            {% for image in project.get_gallery_images %}
                            <div class="gallery-item">
                                <img src="{{ image.url }}" alt="{{ project.title }} - изображение {{ forloop.counter }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="sidebar">
                        <h3>Детали проекта</h3>
                        
                        {% if project.client %}
                        <div class="sidebar-item">
                            <div class="sidebar-label">Клиент</div>
                            <div class="sidebar-value">{{ project.client }}</div>
                        </div>
                        {% endif %}
                        
                        {% if project.duration %}
                        <div class="sidebar-item">
                            <div class="sidebar-label">Срок</div>
                            <div class="sidebar-value">{{ project.duration }}</div>
                        </div>
                        {% endif %}
                        
                        {% if project.budget %}
                        <div class="sidebar-item">
                            <div class="sidebar-label">Бюджет</div>
                            <div class="sidebar-value">{{ project.budget }}</div>
                        </div>
                        {% endif %}
                        
                        <div class="sidebar-item">
                            <div class="sidebar-label">Технологии</div>
                            <div class="sidebar-value">{{ project.technologies }}</div>
                        </div>
                        
                        {% if project.team_size %}
                        <div class="sidebar-item">
                            <div class="sidebar-label">Команда</div>
                            <div class="sidebar-value">{{ project.team_size }}</div>
                        </div>
                        {% endif %}

                        <div class="project-links">
                            <a href="{% url 'main:contact' %}" class="btn btn-primary">
                                <i class='bx bx-message-dots'></i>
                                Обсудить проект
                            </a>
                            <a href="{% url 'portfolio:portfolio_list' %}" class="btn">
                                <i class='bx bx-arrow-back'></i>
                                Другие проекты
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <script>
        (function(){
            const header=document.querySelector('header.site');
            const onScroll=()=>{ if(window.scrollY>8) header.classList.add('scrolled'); else header.classList.remove('scrolled'); };
            onScroll();
            window.addEventListener('scroll', onScroll, {passive:true});

            // click background effect: pixel-aligned grid burst (anchored to page)
            const canvas = document.getElementById('fx');
            const ctx = canvas.getContext('2d');
            const DPR = Math.max(1, Math.floor(window.devicePixelRatio || 1));
            const resize = () => {
                const doc = document.documentElement;
                const w = Math.max(doc.scrollWidth, innerWidth);
                const h = Math.max(doc.scrollHeight, innerHeight);
                canvas.width = Math.floor(w * DPR);
                canvas.height = Math.floor(h * DPR);
                canvas.style.width = w + 'px';
                canvas.style.height = h + 'px';
                ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
            };
            resize();
            window.addEventListener('resize', resize);

            const bursts = [];
            const GRID = 8;
            function snap(v) { return Math.round(v / GRID) * GRID; }
            function addBurst(x, y) {
                const start = performance.now();
                const cells = [];
                const steps = 60 + Math.floor(Math.random() * 40);
                let gx = snap(x), gy = snap(y);
                const dirs = [ [GRID,0], [-GRID,0], [0,GRID], [0,-GRID] ];
                const used = new Set();
                function key(cx, cy) { return cx+','+cy; }
                used.add(key(gx,gy));
                cells.push({ x: gx, y: gy, d: 0 });
                for (let i=0;i<steps;i++) {
                    const [dx,dy] = dirs[(Math.random()*dirs.length)|0];
                    gx += dx; gy += dy;
                    const k = key(gx,gy);
                    if (used.has(k)) continue;
                    used.add(k);
                    cells.push({ x: gx, y: gy, d: i+1 });
                }
                cells.forEach(c => { c.delay = 30 + Math.random()*300 + c.d*6; c.size = 2; c.alpha = 0; });
                bursts.push({ start, cells, duration: 1200 });
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const now = performance.now();
                for (let b = bursts.length - 1; b >= 0; b--) {
                    const burst = bursts[b];
                    const elapsed = now - burst.start;
                    burst.cells.forEach(c => {
                        const t = Math.max(0, Math.min(1, (elapsed - c.delay) / 600));
                        if (t <= 0) return;
                        const ease = t * (2 - t);
                        const sz = 2 + ease * 6;
                        const a = 0.35 * (1 - t);
                        ctx.fillStyle = `rgba(0,0,0,${a})`;
                        const cx = c.x - sz/2, cy = c.y - sz/2;
                        ctx.fillRect(Math.round(cx)+0.5, Math.round(cy)+0.5, Math.round(sz), Math.round(sz));
                    });
                    if (elapsed > burst.duration + 800) bursts.splice(b, 1);
                }
                requestAnimationFrame(draw);
            }
            draw();

            document.addEventListener('click', (e) => {
                const target = e.target;
                if (target.closest('a, button, .btn, .card, .partner, footer')) return;
                const x = window.scrollX + e.clientX;
                const y = window.scrollY + e.clientY;
                addBurst(x, y);
            });
        })();
        </script>

        <footer>
            <a href="{% url 'main:home' %}" rel="noopener">Главная</a>
            <a href="{% url 'main:about' %}" rel="noopener">О студии</a>
            <a href="{% url 'main:contact' %}" rel="noopener">Контакты</a>
            </br>
            <p style="margin-top: 7px;">Сделано с <span class="heart" aria-label="с любовью"><i class='bx bxs-heart' style="color:red;"></i></span> студией monocode • © <span id="y"></span></p>
            <script>document.getElementById('y').textContent = new Date().getFullYear();</script>
        </footer>
    </body>
</html>
